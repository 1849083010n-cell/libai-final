import streamlit as st
import pandas as pd
import folium
from streamlit_folium import st_folium
import os
from app import load_and_prepare_data, create_li_bai_map  # å¤ç”¨ä¸»é¡µé¢å‡½æ•°

# é¡µé¢é…ç½®
st.set_page_config(page_title="æç™½é’å¹´æ—¶æœŸ", page_icon="ğŸŒ±", layout="wide")

# åŠ è½½é’å¹´æ—¶æœŸæ•°æ®ï¼ˆç­›é€‰â€œé’å¹´â€ç›¸å…³é˜¶æ®µï¼‰
XLSX_FILENAME = "æç™½äººç”Ÿé‡è¦èŠ‚ç‚¹ä¸ä»£è¡¨ä½œåœ°ç†ä½ç½®.xlsx"
youth_df = load_and_prepare_data(XLSX_FILENAME, time_period="youth")

# é¡µé¢æ ‡é¢˜ä¸è¯´æ˜
st.header("ğŸŒ± æç™½é’å¹´æ—¶æœŸï¼ˆçº¦701-725å¹´ï¼‰")
st.subheader("æ ¸å¿ƒè¶³è¿¹ï¼šèœ€åœ°æˆé•¿ â†’ å‡ºèœ€æ¼«æ¸¸")
st.info("é’å¹´æç™½éšå±…èœ€åœ°ã€è‹¦è¯»æ¸¸å­¦ï¼Œåâ€œä»—å‰‘å»å›½â€ï¼Œå¼€å¯æ¼«æ¸¸ç”Ÿæ¶¯ï¼Œè¶³è¿¹é›†ä¸­äºèœ€åœ°åŠé•¿æ±Ÿä¸­ä¸‹æ¸¸ã€‚")

# æ˜¾ç¤ºæ•°æ®ä¸åœ°å›¾
if youth_df.empty:
    st.error("âŒ æœªæ‰¾åˆ°æç™½é’å¹´æ—¶æœŸçš„æ•°æ®ï¼Œè¯·æ£€æŸ¥Excelæ–‡ä»¶ä¸­â€œé˜¶æ®µï¼ˆå¤§è‡´å¹´ä»½ï¼‰â€åˆ—æ˜¯å¦åŒ…å«â€œé’å¹´â€å…³é”®è¯ã€‚")
else:
    # åˆ†æ ï¼šå·¦ä¾§æ•°æ®è¡¨æ ¼ï¼Œå³ä¾§åœ°å›¾
    col1, col2 = st.columns([1, 2])
    with col1:
        st.subheader("é’å¹´æ—¶æœŸå…³é”®èŠ‚ç‚¹")
        st.dataframe(youth_df[['åºå·', 'é˜¶æ®µï¼ˆå¤§è‡´å¹´ä»½ï¼‰', 'åœ°ç‚¹ï¼ˆå¤ç§°/ä»Šç§°ï¼‰', 'è¯—ä½œ/äº‹ä»¶æ‘˜è¦', 'æ ¸å¿ƒæƒ…æ„Ÿ/ä¸»é¢˜']], use_container_width=True)
    with col2:
        st.subheader("é’å¹´æ—¶æœŸè¶³è¿¹åœ°å›¾")
        youth_map = create_li_bai_map(youth_df, highlight_key=None)
        st_folium(youth_map, width=800, height=600)

# é’å¹´æ—¶æœŸç®€ä»‹
st.markdown("""
---
### ğŸ“– é’å¹´æ—¶æœŸç®€ä»‹
- **æ—¶é—´èŒƒå›´**ï¼šçº¦å…¬å…ƒ701å¹´ï¼ˆå‡ºç”Ÿï¼‰è‡³725å¹´ï¼ˆå‡ºèœ€æ¼«æ¸¸å‰ï¼‰
- **æ ¸å¿ƒç»å†**ï¼šå‡ºç”Ÿäºç¢å¶åŸï¼Œå¹¼å¹´éšçˆ¶è¿å±…èœ€åœ°æ±Ÿæ²¹ï¼Œåœ¨èœ€ä¸­éšå±…è‹¦è¯»ï¼Œåšè§ˆç¾¤ä¹¦ï¼Œä¹ å‰‘æœ¯ã€‚
- **ä»£è¡¨è¯—ä½œ**ï¼šã€Šå³¨çœ‰å±±æœˆæ­Œã€‹ã€Šæ¸¡è†é—¨é€åˆ«ã€‹ç­‰
- **äººç”ŸåŸºè°ƒ**ï¼šå£®å¿—æ»¡æ€€ï¼Œæ¸´æœ›å»ºåŠŸç«‹ä¸šï¼Œä¸ºæ—¥åæ¼«æ¸¸å››æ–¹ã€å…¥ä»•é•¿å®‰åŸ‹ä¸‹ä¼ç¬”ã€‚
""")

import streamlit as st
import pandas as pd
import folium
from streamlit_folium import st_folium
import os
from app import load_and_prepare_data, create_li_bai_map  # å¤ç”¨ä¸»é¡µé¢å‡½æ•°

# é¡µé¢é…ç½®
st.set_page_config(page_title="æç™½ä¸­å¹´æ—¶æœŸ", page_icon="ğŸŒ¿", layout="wide")

# åŠ è½½ä¸­å¹´æ—¶æœŸæ•°æ®ï¼ˆç­›é€‰â€œä¸­å¹´â€ç›¸å…³é˜¶æ®µï¼‰
XLSX_FILENAME = "æç™½äººç”Ÿé‡è¦èŠ‚ç‚¹ä¸ä»£è¡¨ä½œåœ°ç†ä½ç½®.xlsx"
middle_df = load_and_prepare_data(XLSX_FILENAME, time_period="middle")

# é¡µé¢æ ‡é¢˜ä¸è¯´æ˜
st.header("ğŸŒ¿ æç™½ä¸­å¹´æ—¶æœŸï¼ˆçº¦726-742å¹´ï¼‰")
st.subheader("æ ¸å¿ƒè¶³è¿¹ï¼šæ¼«æ¸¸å››æ–¹ â†’ å…¥ä»•é•¿å®‰")
st.info("ä¸­å¹´æç™½éå†å´ã€è¶Šã€æ¥šã€é½ç­‰åœ°ï¼Œç»“äº¤å‹äººã€é¥®é…’ä½œè¯—ï¼Œåç»äººä¸¾èå…¥ä»•é•¿å®‰ï¼Œä¾›å¥‰ç¿°æ—ã€‚")

# æ˜¾ç¤ºæ•°æ®ä¸åœ°å›¾
if middle_df.empty:
    st.error("âŒ æœªæ‰¾åˆ°æç™½ä¸­å¹´æ—¶æœŸçš„æ•°æ®ï¼Œè¯·æ£€æŸ¥Excelæ–‡ä»¶ä¸­â€œé˜¶æ®µï¼ˆå¤§è‡´å¹´ä»½ï¼‰â€åˆ—æ˜¯å¦åŒ…å«â€œä¸­å¹´â€å…³é”®è¯ã€‚")
else:
    # åˆ†æ ï¼šå·¦ä¾§æ•°æ®è¡¨æ ¼ï¼Œå³ä¾§åœ°å›¾
    col1, col2 = st.columns([1, 2])
    with col1:
        st.subheader("ä¸­å¹´æ—¶æœŸå…³é”®èŠ‚ç‚¹")
        st.dataframe(middle_df[['åºå·', 'é˜¶æ®µï¼ˆå¤§è‡´å¹´ä»½ï¼‰', 'åœ°ç‚¹ï¼ˆå¤ç§°/ä»Šç§°ï¼‰', 'è¯—ä½œ/äº‹ä»¶æ‘˜è¦', 'æ ¸å¿ƒæƒ…æ„Ÿ/ä¸»é¢˜']], use_container_width=True)
    with col2:
        st.subheader("ä¸­å¹´æ—¶æœŸè¶³è¿¹åœ°å›¾")
        middle_map = create_li_bai_map(middle_df, highlight_key=None)
        st_folium(middle_map, width=800, height=600)

# ä¸­å¹´æ—¶æœŸç®€ä»‹
st.markdown("""
---
### ğŸ“– ä¸­å¹´æ—¶æœŸç®€ä»‹
- **æ—¶é—´èŒƒå›´**ï¼šçº¦å…¬å…ƒ726å¹´ï¼ˆå‡ºèœ€åï¼‰è‡³742å¹´ï¼ˆå…¥ä»•é•¿å®‰å‰ï¼‰
- **æ ¸å¿ƒç»å†**ï¼šæ¼«æ¸¸é•¿æ±Ÿã€é»„æ²³æµåŸŸï¼Œç»“è¯†å­Ÿæµ©ç„¶ã€æœç”«ç­‰å‹äººï¼Œåˆ›ä½œå¤§é‡å±±æ°´è¯—ã€é€åˆ«è¯—ï¼›åè¢«å¬å…¥é•¿å®‰ï¼Œä¸ºå”ç„å®—è‰æ‹Ÿæ–‡è¯°ã€é™ªå®´èµ‹è¯—ã€‚
- **ä»£è¡¨è¯—ä½œ**ï¼šã€Šé»„é¹¤æ¥¼é€å­Ÿæµ©ç„¶ä¹‹å¹¿é™µã€‹ã€Šæœ›åºå±±ç€‘å¸ƒã€‹ã€Šå°†è¿›é…’ã€‹ç­‰
- **äººç”ŸåŸºè°ƒ**ï¼šä»•é€”å¾—æ„ä¸å¤±æ„äº¤ç»‡ï¼Œç‹‚æ”¾ä¸ç¾çš„ä¸ªæ€§ä¸å®˜åœºè§„åˆ™äº§ç”Ÿå†²çªã€‚
""")

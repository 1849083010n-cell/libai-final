import streamlit as st
import pandas as pd
import folium
from streamlit_folium import st_folium
import os
from app import load_and_prepare_data, create_li_bai_map  # å¤ç”¨ä¸»é¡µé¢å‡½æ•°

# é¡µé¢é…ç½®
st.set_page_config(page_title="æç™½æ™šå¹´æ—¶æœŸ", page_icon="ğŸ‚", layout="wide")

# åŠ è½½æ™šå¹´æ—¶æœŸæ•°æ®ï¼ˆç­›é€‰â€œæ™šå¹´â€ç›¸å…³é˜¶æ®µï¼‰
XLSX_FILENAME = "æç™½äººç”Ÿé‡è¦èŠ‚ç‚¹ä¸ä»£è¡¨ä½œåœ°ç†ä½ç½®.xlsx"
old_df = load_and_prepare_data(XLSX_FILENAME, time_period="old")

# é¡µé¢æ ‡é¢˜ä¸è¯´æ˜
st.header("ğŸ‚ æç™½æ™šå¹´æ—¶æœŸï¼ˆçº¦743-762å¹´ï¼‰")
st.subheader("æ ¸å¿ƒè¶³è¿¹ï¼šç¦»å¼€é•¿å®‰ â†’ æµæ”¾å¤œéƒ â†’ ç—…é€å½“æ¶‚")
st.info("æ™šå¹´æç™½é­è´¬ç¦»äº¬ï¼Œå†åº¦æ¼«æ¸¸ï¼Œåå› é™„æ°¸ç‹å—ç´¯æµæ”¾å¤œéƒï¼Œé‡èµ¦åæ¼‚æ³Šæ±Ÿå—ï¼Œæœ€ç»ˆç—…é€äºå½“æ¶‚ã€‚")

# æ˜¾ç¤ºæ•°æ®ä¸åœ°å›¾
if old_df.empty:
    st.error("âŒ æœªæ‰¾åˆ°æç™½æ™šå¹´æ—¶æœŸçš„æ•°æ®ï¼Œè¯·æ£€æŸ¥Excelæ–‡ä»¶ä¸­â€œé˜¶æ®µï¼ˆå¤§è‡´å¹´ä»½ï¼‰â€åˆ—æ˜¯å¦åŒ…å«â€œæ™šå¹´â€å…³é”®è¯ã€‚")
else:
    # åˆ†æ ï¼šå·¦ä¾§æ•°æ®è¡¨æ ¼ï¼Œå³ä¾§åœ°å›¾
    col1, col2 = st.columns([1, 2])
    with col1:
        st.subheader("æ™šå¹´æ—¶æœŸå…³é”®èŠ‚ç‚¹")
        st.dataframe(old_df[['åºå·', 'é˜¶æ®µï¼ˆå¤§è‡´å¹´ä»½ï¼‰', 'åœ°ç‚¹ï¼ˆå¤ç§°/ä»Šç§°ï¼‰', 'è¯—ä½œ/äº‹ä»¶æ‘˜è¦', 'æ ¸å¿ƒæƒ…æ„Ÿ/ä¸»é¢˜']], use_container_width=True)
    with col2:
        st.subheader("æ™šå¹´æ—¶æœŸè¶³è¿¹åœ°å›¾")
        old_map = create_li_bai_map(old_df, highlight_key=None)
        st_folium(old_map, width=800, height=600)

# æ™šå¹´æ—¶æœŸç®€ä»‹
st.markdown("""
---
### ğŸ“– æ™šå¹´æ—¶æœŸç®€ä»‹
- **æ—¶é—´èŒƒå›´**ï¼šçº¦å…¬å…ƒ743å¹´ï¼ˆç¦»äº¬åï¼‰è‡³762å¹´ï¼ˆç—…é€ï¼‰
- **æ ¸å¿ƒç»å†**ï¼šç¦»å¼€é•¿å®‰åæ¼«æ¸¸æ¢å®‹ã€é½é²ï¼›å®‰å²ä¹‹ä¹±åä¾é™„æ°¸ç‹æç’˜ï¼Œè¢«æµæ”¾å¤œéƒï¼Œé€”ä¸­é‡èµ¦ä¸œå½’ï¼›æœ€ç»ˆåœ¨å½“æ¶‚ä¾é™„æ—å”æé˜³å†°ï¼Œç—…é€äºå½“æ¶‚ã€‚
- **ä»£è¡¨è¯—ä½œ**ï¼šã€Šæ—©å‘ç™½å¸åŸã€‹ã€Šæœ›å¤©é—¨å±±ã€‹ã€Šä¸´ç»ˆæ­Œã€‹ç­‰
- **äººç”ŸåŸºè°ƒ**ï¼šå†ç»æ²§æ¡‘ï¼Œå£®å¿—æœªé…¬ï¼Œä½†è¯—æ­Œåˆ›ä½œè¾¾åˆ°å·…å³°ï¼Œé£æ ¼æ²‰éƒé¡¿æŒ«ä¸è±ªæ”¾æ´’è„±å¹¶å­˜ã€‚
""")
